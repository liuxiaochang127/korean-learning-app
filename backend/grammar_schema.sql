-- Create grammar_points table
CREATE TABLE IF NOT EXISTS grammar_points (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid (),
    title TEXT NOT NULL, -- e.g. -느라고
    description TEXT NOT NULL, -- e.g. "因为做...（导致负面结果）"
    example_korean TEXT NOT NULL, -- e.g. 공부하느라고 잠을 못 잤어요.
    example_translation TEXT NOT NULL, -- e.g. 因为忙着学习，没睡好觉。
    level TEXT DEFAULT 'Intermediate',
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE grammar_points ENABLE ROW LEVEL SECURITY;

-- Allow read access to everyone
CREATE POLICY "Allow public read access" ON grammar_points FOR
SELECT USING (true);

-- Seed 50 grammar points
INSERT INTO
    grammar_points (
        title,
        description,
        example_korean,
        example_translation,
        level
    )
VALUES (
        '-기 때문에',
        '表示原因或理由，“因为……”',
        '비가 오기 때문에 집에 있을 거예요.',
        '因为下雨，我会待在家里。',
        'Beginner'
    ),
    (
        '-는 동안',
        '表示动作进行的期间，“在……期间”',
        '내가 자는 동안 전화가 왔어요.',
        '我睡觉的时候电话来了。',
        'Beginner'
    ),
    (
        '-자마자',
        '表示前一个动作结束后紧接着发生后一个动作，“一……就……”',
        '집에 오자마자 손을 씻어요.',
        '一回家就洗手。',
        'Intermediate'
    ),
    (
        '-을 수 있다/없다',
        '表示能力或可能性，“能/不能……”',
        '한국 음식을 만들 수 있어요.',
        '我会做韩国菜。',
        'Beginner'
    ),
    (
        '-아/어/여야 하다',
        '表示义务或必要性，“必须……”',
        '내일 일찍 일어나야 해요.',
        '明天必须早起。',
        'Beginner'
    ),
    (
        '-게 되다',
        '表示状态的变化或结果，“变得……”，“使得……”',
        '한국에 오게 되었어요.',
        '来到了韩国（变得在韩国了/有机会来韩国了）。',
        'Intermediate'
    ),
    (
        '-은/ㄴ 적이 있다',
        '表示过去的经验，“曾经……过”',
        '제주도에 간 적이 있어요.',
        '我去过济州岛。',
        'Beginner'
    ),
    (
        '-기로 하다',
        '表示决定或约定，“决定……”',
        '친구와 만나기로 했어요.',
        '决定和朋友见面。',
        'Intermediate'
    ),
    (
        '-려고 하다',
        '表示意图或计划，“想要……”，“打算……”',
        '살을 빼려고 운동을 해요.',
        '为了减肥在运动。',
        'Intermediate'
    ),
    (
        '-다가',
        '表示动作的中断或转换，“做着……（中途）”',
        '밥을 먹다가 전화를 받았어요.',
        '吃着饭接了电话。',
        'Intermediate'
    ),
    (
        '-아/어서',
        '表示原因或理由（不能用于命令句/共动句），也可表示顺序，“因为……”，“然后……”',
        '배가 아파서 병원에 갔어요.',
        '因为肚子疼去了医院。',
        'Beginner'
    ),
    (
        '-니까',
        '表示原因或理由（可用于命令句/共动句），“因为……”',
        '추우니까 문을 닫으세요.',
        '因为冷，请关门。',
        'Beginner'
    ),
    (
        '-지 마세요',
        '表示禁止，“请不要……”',
        '여기서 담배를 피우지 마세요.',
        '请不要在这里吸烟。',
        'Beginner'
    ),
    (
        '-고 싶다',
        '表示愿望，“想……”',
        '여행을 가고 싶어요.',
        '想去旅行。',
        'Beginner'
    ),
    (
        '-ㄹ 것입니다 (ㄹ 거예요)',
        '表示推测或未来计划，“将要……”，“可能……”',
        '내일은 날씨가 좋을 거예요.',
        '明天天气应该会好。',
        'Beginner'
    ),
    (
        '-는 중이다',
        '表示正在进行，“正在……”',
        '지금 공부하는 중이에요.',
        '现在正在学习。',
        'Beginner'
    ),
    (
        '-지 않다',
        '表示否定，“不……”',
        '저는 김치를 먹지 않아요.',
        '我不吃泡菜。',
        'Beginner'
    ),
    (
        '-ㄹ 수밖에 없다',
        '表示没有其他选择，“只能……”',
        '그럴 수밖에 없었어요.',
        '只能那样做（别无他法）。',
        'Advanced'
    ),
    (
        '-나 보다',
        '表示推测（主要用于动词/形容词），“看来……”',
        '비가 오나 봐요.',
        '看来下雨了。',
        'Intermediate'
    ),
    (
        '-는 것 같다',
        '表示推测或婉转的表达，“好像……”',
        '저 사람은 한국 사람인 것 같아요.',
        '那个人好像是韩国人。',
        'Beginner'
    ),
    (
        '-기 쉽다/어렵다',
        '表示做某事容易/难，“容易/难……”',
        '이 책은 읽기 쉬워요.',
        '这本书很容易读。',
        'Intermediate'
    ),
    (
        '-아/어/여도 되다',
        '表示许可，“可以……”',
        '여기 앉아도 돼요?',
        '可以坐这里吗？',
        'Beginner'
    ),
    (
        '-으면 안 되다',
        '表示禁止或不允许，“如果不……不行（不能……）”',
        '여기서 사진을 찍으면 안 돼요.',
        '这里不能拍照。',
        'Beginner'
    ),
    (
        '-게',
        '使动词形容词化，或表示目的，“……地”，“为了……”',
        '맛있게 드세요.',
        '请慢用（好吃地吃吧）。',
        'Beginner'
    ),
    (
        '-지 못하다',
        '表示客观上不能，“不能……”（能力不足或环境限制）',
        '매운 음식을 먹지 못해요.',
        '我吃不了辣（不能吃）。',
        'Beginner'
    ),
    (
        '-ㄹ 때',
        '表示时间，“……的时候”',
        '시간이 있을 때 책을 읽어요.',
        '有时间的时候看书。',
        'Beginner'
    ),
    (
        '-기 전에',
        '表示动作之前，“在……之前”',
        '자기 전에 이를 닦아요.',
        '睡觉前刷牙。',
        'Beginner'
    ),
    (
        '-ㄴ 후에',
        '表示动作之后，“在……之后”',
        '밥을 먹은 후에 커피를 마셔요.',
        '吃饭后喝咖啡。',
        'Beginner'
    ),
    (
        '-아/어 주다',
        '表示为某人做某事，“给……做……”',
        '문을 열어 주세요.',
        '请帮我开门。',
        'Beginner'
    ),
    (
        '-아야/어야',
        '表示条件，“只有……才……”',
        '연습해야 잘할 수 있어요.',
        '只有练习才能做得好。',
        'Intermediate'
    ),
    (
        '-ㄹ까 하다',
        '表示不确定的计划，“在这个想……”',
        '여행을 갈까 해요.',
        '在想是不是要去旅行。',
        'Intermediate'
    ),
    (
        '-더라도',
        '表示让步，“即使……”',
        '비가 오더라도 갈 거예요.',
        '即使下雨也要去。',
        'Advanced'
    ),
    (
        '-는 척하다',
        '表示装作，“假装……”',
        '자는 척했어요.',
        '假装睡着了。',
        'Intermediate'
    ),
    (
        '-ㄹ 뻔하다',
        '表示差点发生，“差点……”',
        '넘어질 뻔했어요.',
        '差点摔倒了。',
        'Intermediate'
    ),
    (
        '-던',
        '表示过去持续或回顾，“以前（常做）的……”',
        '여기는 제가 자주 오던 곳이에요.',
        '这里是我以前常来的地方。',
        'Intermediate'
    ),
    (
        '-자',
        '表示共动（非敬语），“……吧”',
        '같이 가자.',
        '一起去吧。',
        'Beginner'
    ),
    (
        '-ㄹ래요',
        '表示意愿或询问意愿，“想……吗？”，“我要……”',
        '커피 마실래요?',
        '要喝咖啡吗？',
        'Beginner'
    ),
    (
        '-거든요',
        '表示说明理由或前提，“因为……”（口语）',
        '저는 배가 안 고파요. 아까 먹었거든요.',
        '我不饿，因为刚才吃过了。',
        'Intermediate'
    ),
    (
        '-잖아요',
        '表示确认对方已知的事实，“不是……嘛”',
        '그 영화 재미있잖아요.',
        '那个电影不是很有趣嘛。',
        'Intermediate'
    ),
    (
        '-네요',
        '表示感叹，“真……啊”',
        '날씨가 정말 좋네요.',
        '天气真好啊。',
        'Beginner'
    ),
    (
        '-는 바람에',
        '表示因为前面的突发原因导致负面结果，“因为……”',
        '늦잠을 자는 바람에 지각했어요.',
        '因为睡懒觉迟到了。',
        'Intermediate'
    ),
    (
        '-기에',
        '书面语表示原因，“因为……”',
        '시간이 없기에 못 갔습니다.',
        '因为没时间没能去。',
        'Advanced'
    ),
    (
        '-길래',
        '口语表示原因（通常用于第一人称后的结果），“因为……”',
        '배가 고프길래 빵을 샀어요.',
        '因为肚子饿买了面包。',
        'Intermediate'
    ),
    (
        '-느라고',
        '表示目的导致无法做其他事（通常是负面），“因为忙于……”',
        '공부하느라고 밤을 샜어요.',
        '因为忙着学习熬夜了。',
        'Intermediate'
    ),
    (
        '-ㄹ 테니까',
        '表示推测条件或意愿条件，“因为会……所以……”',
        '제가 할 테니까 걱정하지 마세요.',
        '我会做的，所以别担心。',
        'Intermediate'
    ),
    (
        '-ㄹ 정도로',
        '表示程度，“到了……的程度”',
        '죽을 정도로 힘들어요.',
        '累得要死（到了要死的程度）。',
        'Intermediate'
    ),
    (
        '-만하다',
        '表示值得，“值得……”',
        '이 영화는 볼 만해요.',
        '这部电影值得看。',
        'Intermediate'
    ),
    (
        '-을지도 모르다',
        '表示推测不确定性，“说不定……”',
        '비가 올지도 몰라요.',
        '说不定会下雨。',
        'Intermediate'
    ),
    (
        '-기 마련이다',
        '表示自然规律，“总是会……”，“难免……”',
        '사람은 누구나 늙기 마련이다.',
        '人总是会老的。',
        'Advanced'
    ),
    (
        '-다면서요',
        '表示确认听到的消息，“听说……是吗？”',
        '결혼한다면서요?',
        '听说你要结婚了？',
        'Intermediate'
    );

-- Additional constraint to ensure non-empty
ALTER TABLE grammar_points
ADD CONSTRAINT title_not_empty CHECK (length(title) > 0);